# ğŸ“š NGINX Hands-on for Multi-Container Pods & Init Containers

## ğŸš€ Multi-Container Pods

### ğŸ§  Theory 

- A **Pod** can contain multiple containers that share the same **network namespace**, **storage volumes**, and **lifecycle**.
- Common patterns:
  - ğŸ”¹ **Sidecar**: Helper containers for the main container.
  - ğŸ”¹ **Adapter**: Containers transforming output.
  - ğŸ”¹ **Ambassador**: Containers acting as proxies.
- **Why?** To split responsibilities and extend functionality without making the main container complex.

**Key Points:**
- ğŸ“¡ All containers in a pod can communicate via `localhost`.
- ğŸ“¦ Volumes are shared.

---

### ğŸ› ï¸ Hands-on Exercise 1: Sidecar Container with NGINX {#hands-on-exercise-1-sidecar-container-with-nginx}

**Objective:** Create a pod with two containers:
- **Main container**: Runs an NGINX server.
- **Sidecar container**: Runs a busybox container that writes logs into a shared volume.

### ğŸ“„ Pod Manifest: `multi-container-nginx.yaml`

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-sidecar-pod
spec:
  containers:
  - name: nginx-container
    image: nginx:1.21
    volumeMounts:
    - name: shared-logs
      mountPath: /usr/share/nginx/html
  - name: log-writer
    image: busybox
    command: ["/bin/sh", "-c", "while true; do echo Hello from Sidecar > /var/log/index.html; sleep 5; done"]
    volumeMounts:
    - name: shared-logs
      mountPath: /var/log
  volumes:
  - name: shared-logs
    emptyDir: {}
```

---

### ğŸš€ Steps to Deploy

```bash
kubectl apply -f multi-container-nginx.yaml
```

---

### ğŸ” Verify

```bash
kubectl get pods
kubectl describe pod nginx-sidecar-pod
kubectl port-forward pod/nginx-sidecar-pod 8080:80
```

ğŸ”— Now visit `http://localhost:8080` â€” you should see **"Hello from Sidecar"** generated by the sidecar!

---

## ğŸš€ Init Containers

### ğŸ§  Theory 

- **Init containers** run **before** app containers start.
- They must **complete successfully** for the Pod to start the main containers.
- Useful for:
  - ğŸ“ Preloading configuration files.
  - ğŸ”§ Setting up preconditions (e.g., database migrations).
  - ğŸ•’ Waiting for external services.

**Key Points:**
- ğŸ–¼ï¸ They have different images from app containers.
- â³ They run **sequentially**, one after the other.

---

### ğŸ› ï¸ Hands-on Exercise 2: Init Container to Preload Data for NGINX {#hands-on-exercise-2-init-container-to-preload-data-for-nginx}

**Objective:**
- Use an init container to **copy a welcome HTML page** into a shared volume.
- Main container (NGINX) will **serve** that page.

### ğŸ“„ Pod Manifest: `nginx-initcontainer.yaml`

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-init-pod
spec:
  initContainers:
  - name: init-copy-html
    image: busybox
    command:
    - /bin/sh
    - -c
    - |
      echo "<h1>Welcome to NGINX served by Init Container!</h1>" > /workdir/index.html
    volumeMounts:
    - name: html-volume
      mountPath: /workdir

  containers:
  - name: nginx-container
    image: nginx:1.21
    volumeMounts:
    - name: html-volume
      mountPath: /usr/share/nginx/html

  volumes:
  - name: html-volume
    emptyDir: {}
```

---

### ğŸš€ Steps to Deploy

```bash
kubectl apply -f nginx-initcontainer.yaml
```

---

### ğŸ” Verify

```bash
kubectl get pods
kubectl describe pod nginx-init-pod
kubectl logs nginx-init-pod -c init-copy-html
kubectl port-forward pod/nginx-init-pod 8080:80
```

ğŸ”— Visit `http://localhost:8080` â€” you should see the HTML content injected by the init container!

---

# ğŸ“Š Summary

| Feature | Multi-Container Pods | Init Containers |
| :------ | :------------------- | :-------------- |
| **Purpose** | Enhance pod with multiple functionalities | Prepare pod before app containers start |
| **When Runs** | Simultaneously | Sequentially before app |
| **Typical Use** | Sidecars, log collectors | Data preload, wait for service |

---

# ğŸ¯ Additional Exercises

- ğŸ”¢ Modify the sidecar to generate a random number every 5 seconds.
- ğŸ”— Chain multiple init containers.
- ğŸ‹ï¸ Use `alpine` instead of `busybox` for lightweight base.

---

# ğŸ“ Notes

- ğŸ§¹ `emptyDir` is ephemeral â€” disappears once the pod is deleted.
- ğŸ“œ Use `kubectl logs pod-name -c container-name` to fetch logs from a specific container.

---

